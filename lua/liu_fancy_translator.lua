-- liu_fancy_translator.lua
-- èŠ±å¼è‹±æ•¸è½‰æ›å™¨
-- `/ = èŠ±å¼Aa, `// = èŠ±å¼aa, `/// = èŠ±å¼AA, `/' = èŠ±å¼æ•¸å­—

-- å¤§å¯«å­—æ¯å°ç…§è¡¨ï¼ˆèŠ±å¼AAç”¨ï¼Œ13ç¨®æ¨£å¼ï¼‰
-- ç´¢å¼•ï¼š1=åœˆåœˆ, 2=è² åœˆ, 3=æ–¹æ¡†, 4=è² æ¡†, 5=æ‹¬è™Ÿ, 6=å…¨å½¢, 7=ç²—é«”, 8=é›™ç·š, 9=ç­‰å¯¬, 10=æ–œé«”, 11=ç²—æ–œ, 12=èŠ±é«”, 13=å“¥å¾·
local fancy_upper = {
  A = {"â’¶", "ğŸ…", "ğŸ„°", "ğŸ…°", "ğŸ„", "ï¼¡", "ğ€", "ğ”¸", "ğ™°", "ğ´", "ğ‘¨", "ğ’œ", "ğ”„"},
  B = {"â’·", "ğŸ…‘", "ğŸ„±", "ğŸ…±", "ğŸ„‘", "ï¼¢", "ğ", "ğ”¹", "ğ™±", "ğµ", "ğ‘©", "â„¬", "ğ”…"},
  C = {"â’¸", "ğŸ…’", "ğŸ„²", "ğŸ…²", "ğŸ„’", "ï¼£", "ğ‚", "â„‚", "ğ™²", "ğ¶", "ğ‘ª", "ğ’", "â„­"},
  D = {"â’¹", "ğŸ…“", "ğŸ„³", "ğŸ…³", "ğŸ„“", "ï¼¤", "ğƒ", "ğ”»", "ğ™³", "ğ·", "ğ‘«", "ğ’Ÿ", "ğ”‡"},
  E = {"â’º", "ğŸ…”", "ğŸ„´", "ğŸ…´", "ğŸ„”", "ï¼¥", "ğ„", "ğ”¼", "ğ™´", "ğ¸", "ğ‘¬", "â„°", "ğ”ˆ"},
  F = {"â’»", "ğŸ…•", "ğŸ„µ", "ğŸ…µ", "ğŸ„•", "ï¼¦", "ğ…", "ğ”½", "ğ™µ", "ğ¹", "ğ‘­", "â„±", "ğ”‰"},
  G = {"â’¼", "ğŸ…–", "ğŸ„¶", "ğŸ…¶", "ğŸ„–", "ï¼§", "ğ†", "ğ”¾", "ğ™¶", "ğº", "ğ‘®", "ğ’¢", "ğ”Š"},
  H = {"â’½", "ğŸ…—", "ğŸ„·", "ğŸ…·", "ğŸ„—", "ï¼¨", "ğ‡", "â„", "ğ™·", "ğ»", "ğ‘¯", "â„‹", "â„Œ"},
  I = {"â’¾", "ğŸ…˜", "ğŸ„¸", "ğŸ…¸", "ğŸ„˜", "ï¼©", "ğˆ", "ğ•€", "ğ™¸", "ğ¼", "ğ‘°", "â„", "â„‘"},
  J = {"â’¿", "ğŸ…™", "ğŸ„¹", "ğŸ…¹", "ğŸ„™", "ï¼ª", "ğ‰", "ğ•", "ğ™¹", "ğ½", "ğ‘±", "ğ’¥", "ğ”"},
  K = {"â“€", "ğŸ…š", "ğŸ„º", "ğŸ…º", "ğŸ„š", "ï¼«", "ğŠ", "ğ•‚", "ğ™º", "ğ¾", "ğ‘²", "ğ’¦", "ğ”"},
  L = {"â“", "ğŸ…›", "ğŸ„»", "ğŸ…»", "ğŸ„›", "ï¼¬", "ğ‹", "ğ•ƒ", "ğ™»", "ğ¿", "ğ‘³", "â„’", "ğ”"},
  M = {"â“‚", "ğŸ…œ", "ğŸ„¼", "ğŸ…¼", "ğŸ„œ", "ï¼­", "ğŒ", "ğ•„", "ğ™¼", "ğ‘€", "ğ‘´", "â„³", "ğ”"},
  N = {"â“ƒ", "ğŸ…", "ğŸ„½", "ğŸ…½", "ğŸ„", "ï¼®", "ğ", "â„•", "ğ™½", "ğ‘", "ğ‘µ", "ğ’©", "ğ”‘"},
  O = {"â“„", "ğŸ…", "ğŸ„¾", "ğŸ…¾", "ğŸ„", "ï¼¯", "ğ", "ğ•†", "ğ™¾", "ğ‘‚", "ğ‘¶", "ğ’ª", "ğ”’"},
  P = {"â“…", "ğŸ…Ÿ", "ğŸ„¿", "ğŸ…¿", "ğŸ„Ÿ", "ï¼°", "ğ", "â„™", "ğ™¿", "ğ‘ƒ", "ğ‘·", "ğ’«", "ğ”“"},
  Q = {"â“†", "ğŸ… ", "ğŸ…€", "ğŸ†€", "ğŸ„ ", "ï¼±", "ğ", "â„š", "ğš€", "ğ‘„", "ğ‘¸", "ğ’¬", "ğ””"},
  R = {"â“‡", "ğŸ…¡", "ğŸ…", "ğŸ†", "ğŸ„¡", "ï¼²", "ğ‘", "â„", "ğš", "ğ‘…", "ğ‘¹", "â„›", "â„œ"},
  S = {"â“ˆ", "ğŸ…¢", "ğŸ…‚", "ğŸ†‚", "ğŸ„¢", "ï¼³", "ğ’", "ğ•Š", "ğš‚", "ğ‘†", "ğ‘º", "ğ’®", "ğ”–"},
  T = {"â“‰", "ğŸ…£", "ğŸ…ƒ", "ğŸ†ƒ", "ğŸ„£", "ï¼´", "ğ“", "ğ•‹", "ğšƒ", "ğ‘‡", "ğ‘»", "ğ’¯", "ğ”—"},
  U = {"â“Š", "ğŸ…¤", "ğŸ…„", "ğŸ†„", "ğŸ„¤", "ï¼µ", "ğ”", "ğ•Œ", "ğš„", "ğ‘ˆ", "ğ‘¼", "ğ’°", "ğ”˜"},
  V = {"â“‹", "ğŸ…¥", "ğŸ……", "ğŸ†…", "ğŸ„¥", "ï¼¶", "ğ•", "ğ•", "ğš…", "ğ‘‰", "ğ‘½", "ğ’±", "ğ”™"},
  W = {"â“Œ", "ğŸ…¦", "ğŸ…†", "ğŸ††", "ğŸ„¦", "ï¼·", "ğ–", "ğ•", "ğš†", "ğ‘Š", "ğ‘¾", "ğ’²", "ğ”š"},
  X = {"â“", "ğŸ…§", "ğŸ…‡", "ğŸ†‡", "ğŸ„§", "ï¼¸", "ğ—", "ğ•", "ğš‡", "ğ‘‹", "ğ‘¿", "ğ’³", "ğ”›"},
  Y = {"â“", "ğŸ…¨", "ğŸ…ˆ", "ğŸ†ˆ", "ğŸ„¨", "ï¼¹", "ğ˜", "ğ•", "ğšˆ", "ğ‘Œ", "ğ’€", "ğ’´", "ğ”œ"},
  Z = {"â“", "ğŸ…©", "ğŸ…‰", "ğŸ†‰", "ğŸ„©", "ï¼º", "ğ™", "â„¤", "ğš‰", "ğ‘", "ğ’", "ğ’µ", "â„¨"},
}

-- å¤§å¯«å­—æ¯å°ç…§è¡¨ï¼ˆèŠ±å¼Aaç”¨ï¼Œ10ç¨®æ¨£å¼ï¼Œç§»é™¤è² åœˆã€æ–¹æ¡†ã€è² æ¡†ï¼‰
-- ç´¢å¼•ï¼š1=åœˆåœˆ, 2=æ‹¬è™Ÿ, 3=å…¨å½¢, 4=ç²—é«”, 5=é›™ç·š, 6=ç­‰å¯¬, 7=æ–œé«”, 8=ç²—æ–œ, 9=èŠ±é«”, 10=å“¥å¾·
local fancy_upper_title = {
  A = {"â’¶", "ğŸ„", "ï¼¡", "ğ€", "ğ”¸", "ğ™°", "ğ´", "ğ‘¨", "ğ’œ", "ğ”„"},
  B = {"â’·", "ğŸ„‘", "ï¼¢", "ğ", "ğ”¹", "ğ™±", "ğµ", "ğ‘©", "â„¬", "ğ”…"},
  C = {"â’¸", "ğŸ„’", "ï¼£", "ğ‚", "â„‚", "ğ™²", "ğ¶", "ğ‘ª", "ğ’", "â„­"},
  D = {"â’¹", "ğŸ„“", "ï¼¤", "ğƒ", "ğ”»", "ğ™³", "ğ·", "ğ‘«", "ğ’Ÿ", "ğ”‡"},
  E = {"â’º", "ğŸ„”", "ï¼¥", "ğ„", "ğ”¼", "ğ™´", "ğ¸", "ğ‘¬", "â„°", "ğ”ˆ"},
  F = {"â’»", "ğŸ„•", "ï¼¦", "ğ…", "ğ”½", "ğ™µ", "ğ¹", "ğ‘­", "â„±", "ğ”‰"},
  G = {"â’¼", "ğŸ„–", "ï¼§", "ğ†", "ğ”¾", "ğ™¶", "ğº", "ğ‘®", "ğ’¢", "ğ”Š"},
  H = {"â’½", "ğŸ„—", "ï¼¨", "ğ‡", "â„", "ğ™·", "ğ»", "ğ‘¯", "â„‹", "â„Œ"},
  I = {"â’¾", "ğŸ„˜", "ï¼©", "ğˆ", "ğ•€", "ğ™¸", "ğ¼", "ğ‘°", "â„", "â„‘"},
  J = {"â’¿", "ğŸ„™", "ï¼ª", "ğ‰", "ğ•", "ğ™¹", "ğ½", "ğ‘±", "ğ’¥", "ğ”"},
  K = {"â“€", "ğŸ„š", "ï¼«", "ğŠ", "ğ•‚", "ğ™º", "ğ¾", "ğ‘²", "ğ’¦", "ğ”"},
  L = {"â“", "ğŸ„›", "ï¼¬", "ğ‹", "ğ•ƒ", "ğ™»", "ğ¿", "ğ‘³", "â„’", "ğ”"},
  M = {"â“‚", "ğŸ„œ", "ï¼­", "ğŒ", "ğ•„", "ğ™¼", "ğ‘€", "ğ‘´", "â„³", "ğ”"},
  N = {"â“ƒ", "ğŸ„", "ï¼®", "ğ", "â„•", "ğ™½", "ğ‘", "ğ‘µ", "ğ’©", "ğ”‘"},
  O = {"â“„", "ğŸ„", "ï¼¯", "ğ", "ğ•†", "ğ™¾", "ğ‘‚", "ğ‘¶", "ğ’ª", "ğ”’"},
  P = {"â“…", "ğŸ„Ÿ", "ï¼°", "ğ", "â„™", "ğ™¿", "ğ‘ƒ", "ğ‘·", "ğ’«", "ğ”“"},
  Q = {"â“†", "ğŸ„ ", "ï¼±", "ğ", "â„š", "ğš€", "ğ‘„", "ğ‘¸", "ğ’¬", "ğ””"},
  R = {"â“‡", "ğŸ„¡", "ï¼²", "ğ‘", "â„", "ğš", "ğ‘…", "ğ‘¹", "â„›", "â„œ"},
  S = {"â“ˆ", "ğŸ„¢", "ï¼³", "ğ’", "ğ•Š", "ğš‚", "ğ‘†", "ğ‘º", "ğ’®", "ğ”–"},
  T = {"â“‰", "ğŸ„£", "ï¼´", "ğ“", "ğ•‹", "ğšƒ", "ğ‘‡", "ğ‘»", "ğ’¯", "ğ”—"},
  U = {"â“Š", "ğŸ„¤", "ï¼µ", "ğ”", "ğ•Œ", "ğš„", "ğ‘ˆ", "ğ‘¼", "ğ’°", "ğ”˜"},
  V = {"â“‹", "ğŸ„¥", "ï¼¶", "ğ•", "ğ•", "ğš…", "ğ‘‰", "ğ‘½", "ğ’±", "ğ”™"},
  W = {"â“Œ", "ğŸ„¦", "ï¼·", "ğ–", "ğ•", "ğš†", "ğ‘Š", "ğ‘¾", "ğ’²", "ğ”š"},
  X = {"â“", "ğŸ„§", "ï¼¸", "ğ—", "ğ•", "ğš‡", "ğ‘‹", "ğ‘¿", "ğ’³", "ğ”›"},
  Y = {"â“", "ğŸ„¨", "ï¼¹", "ğ˜", "ğ•", "ğšˆ", "ğ‘Œ", "ğ’€", "ğ’´", "ğ”œ"},
  Z = {"â“", "ğŸ„©", "ï¼º", "ğ™", "â„¤", "ğš‰", "ğ‘", "ğ’", "ğ’µ", "â„¨"},
}


-- å°å¯«å­—æ¯å°ç…§è¡¨ï¼ˆ10ç¨®æ¨£å¼ï¼Œç§»é™¤è² åœˆã€æ–¹æ¡†ã€è² æ¡†ï¼‰
-- ç´¢å¼•ï¼š1=åœˆåœˆ, 2=æ‹¬è™Ÿ, 3=å…¨å½¢, 4=ä¸‹æ¨™, 5=ä¸Šæ¨™, 6=ç²—é«”, 7=é›™ç·š, 8=ç­‰å¯¬, 9=èŠ±é«”, 10=å“¥å¾·
-- å°å¯«å­—æ¯å°ç…§è¡¨ï¼ˆ10ç¨®æ¨£å¼ï¼Œç§»é™¤è² åœˆã€æ–¹æ¡†ã€è² æ¡†ï¼‰
-- ç´¢å¼•ï¼š1=åœˆåœˆ, 2=æ‹¬è™Ÿ, 3=å…¨å½¢, 4=ç²—é«”, 5=é›™ç·š, 6=ç­‰å¯¬, 7=æ–œé«”, 8=ç²—æ–œ, 9=èŠ±é«”, 10=å“¥å¾·
local fancy_lower = {
  a = {"â“", "â’œ", "ï½", "ğš", "ğ•’", "ğšŠ", "ğ‘", "ğ’‚", "ğ’¶", "ğ”"},
  b = {"â“‘", "â’", "ï½‚", "ğ›", "ğ•“", "ğš‹", "ğ‘", "ğ’ƒ", "ğ’·", "ğ”Ÿ"},
  c = {"â“’", "â’", "ï½ƒ", "ğœ", "ğ•”", "ğšŒ", "ğ‘", "ğ’„", "ğ’¸", "ğ” "},
  d = {"â““", "â’Ÿ", "ï½„", "ğ", "ğ••", "ğš", "ğ‘‘", "ğ’…", "ğ’¹", "ğ”¡"},
  e = {"â“”", "â’ ", "ï½…", "ğ", "ğ•–", "ğš", "ğ‘’", "ğ’†", "â„¯", "ğ”¢"},
  f = {"â“•", "â’¡", "ï½†", "ğŸ", "ğ•—", "ğš", "ğ‘“", "ğ’‡", "ğ’»", "ğ”£"},
  g = {"â“–", "â’¢", "ï½‡", "ğ ", "ğ•˜", "ğš", "ğ‘”", "ğ’ˆ", "â„Š", "ğ”¤"},
  h = {"â“—", "â’£", "ï½ˆ", "ğ¡", "ğ•™", "ğš‘", "â„", "ğ’‰", "ğ’½", "ğ”¥"},
  i = {"â“˜", "â’¤", "ï½‰", "ğ¢", "ğ•š", "ğš’", "ğ‘–", "ğ’Š", "ğ’¾", "ğ”¦"},
  j = {"â“™", "â’¥", "ï½Š", "ğ£", "ğ•›", "ğš“", "ğ‘—", "ğ’‹", "ğ’¿", "ğ”§"},
  k = {"â“š", "â’¦", "ï½‹", "ğ¤", "ğ•œ", "ğš”", "ğ‘˜", "ğ’Œ", "ğ“€", "ğ”¨"},
  l = {"â“›", "â’§", "ï½Œ", "ğ¥", "ğ•", "ğš•", "ğ‘™", "ğ’", "ğ“", "ğ”©"},
  m = {"â“œ", "â’¨", "ï½", "ğ¦", "ğ•", "ğš–", "ğ‘š", "ğ’", "ğ“‚", "ğ”ª"},
  n = {"â“", "â’©", "ï½", "ğ§", "ğ•Ÿ", "ğš—", "ğ‘›", "ğ’", "ğ“ƒ", "ğ”«"},
  o = {"â“", "â’ª", "ï½", "ğ¨", "ğ• ", "ğš˜", "ğ‘œ", "ğ’", "â„´", "ğ”¬"},
  p = {"â“Ÿ", "â’«", "ï½", "ğ©", "ğ•¡", "ğš™", "ğ‘", "ğ’‘", "ğ“…", "ğ”­"},
  q = {"â“ ", "â’¬", "ï½‘", "ğª", "ğ•¢", "ğšš", "ğ‘", "ğ’’", "ğ“†", "ğ”®"},
  r = {"â“¡", "â’­", "ï½’", "ğ«", "ğ•£", "ğš›", "ğ‘Ÿ", "ğ’“", "ğ“‡", "ğ”¯"},
  s = {"â“¢", "â’®", "ï½“", "ğ¬", "ğ•¤", "ğšœ", "ğ‘ ", "ğ’”", "ğ“ˆ", "ğ”°"},
  t = {"â“£", "â’¯", "ï½”", "ğ­", "ğ•¥", "ğš", "ğ‘¡", "ğ’•", "ğ“‰", "ğ”±"},
  u = {"â“¤", "â’°", "ï½•", "ğ®", "ğ•¦", "ğš", "ğ‘¢", "ğ’–", "ğ“Š", "ğ”²"},
  v = {"â“¥", "â’±", "ï½–", "ğ¯", "ğ•§", "ğšŸ", "ğ‘£", "ğ’—", "ğ“‹", "ğ”³"},
  w = {"â“¦", "â’²", "ï½—", "ğ°", "ğ•¨", "ğš ", "ğ‘¤", "ğ’˜", "ğ“Œ", "ğ”´"},
  x = {"â“§", "â’³", "ï½˜", "ğ±", "ğ•©", "ğš¡", "ğ‘¥", "ğ’™", "ğ“", "ğ”µ"},
  y = {"â“¨", "â’´", "ï½™", "ğ²", "ğ•ª", "ğš¢", "ğ‘¦", "ğ’š", "ğ“", "ğ”¶"},
  z = {"â“©", "â’µ", "ï½š", "ğ³", "ğ•«", "ğš£", "ğ‘§", "ğ’›", "ğ“", "ğ”·"},
}

-- æ•¸å­—å°ç…§è¡¨ï¼ˆ16ç¨®æ¨£å¼ï¼‰
-- ç´¢å¼•ï¼š1=åœˆåœˆ, 2=è² åœˆ, 3=æ–¹æ¡†, 4=è² æ¡†, 5=æ‹¬è™Ÿ, 6=é»æ•¸, 7=å…¨å½¢, 8=ä¸‹æ¨™, 9=ä¸Šæ¨™, 10=ç²—é«”, 11=é›™ç·š, 12=ç­‰å¯¬, 13=ç„¡è¥¯ç·š, 14=ç„¡è¥¯ç·šç²—, 15=åœˆæ¼¢, 16=æ‹¬æ¼¢
local fancy_digits = {
  ["0"] = {"â“ª", "ğŸ„‹", "â“¿", "â’ª", "ğŸ„€", "ğŸ„", "ï¼", "â‚€", "â°", "ğŸ", "ğŸ˜", "ğŸ¶", "ğŸ¢", "ğŸ¬", "â“„", "â’ª"},
  ["1"] = {"â‘ ", "â“µ", "â¶", "â‘´", "â’ˆ", "ğŸ„‚", "ï¼‘", "â‚", "Â¹", "ğŸ", "ğŸ™", "ğŸ·", "ğŸ£", "ğŸ­", "ãŠ€", "ãˆ "},
  ["2"] = {"â‘¡", "â“¶", "â·", "â‘µ", "â’‰", "ğŸ„ƒ", "ï¼’", "â‚‚", "Â²", "ğŸ", "ğŸš", "ğŸ¸", "ğŸ¤", "ğŸ®", "ãŠ", "ãˆ¡"},
  ["3"] = {"â‘¢", "â“·", "â¸", "â‘¶", "â’Š", "ğŸ„„", "ï¼“", "â‚ƒ", "Â³", "ğŸ‘", "ğŸ›", "ğŸ¹", "ğŸ¥", "ğŸ¯", "ãŠ‚", "ãˆ¢"},
  ["4"] = {"â‘£", "â“¸", "â¹", "â‘·", "â’‹", "ğŸ„…", "ï¼”", "â‚„", "â´", "ğŸ’", "ğŸœ", "ğŸº", "ğŸ¦", "ğŸ°", "ãŠƒ", "ãˆ£"},
  ["5"] = {"â‘¤", "â“¹", "âº", "â‘¸", "â’Œ", "ğŸ„†", "ï¼•", "â‚…", "âµ", "ğŸ“", "ğŸ", "ğŸ»", "ğŸ§", "ğŸ±", "ãŠ„", "ãˆ¤"},
  ["6"] = {"â‘¥", "â“º", "â»", "â‘¹", "â’", "ğŸ„‡", "ï¼–", "â‚†", "â¶", "ğŸ”", "ğŸ", "ğŸ¼", "ğŸ¨", "ğŸ²", "ãŠ…", "ãˆ¥"},
  ["7"] = {"â‘¦", "â“»", "â¼", "â‘º", "â’", "ğŸ„ˆ", "ï¼—", "â‚‡", "â·", "ğŸ•", "ğŸŸ", "ğŸ½", "ğŸ©", "ğŸ³", "ãŠ†", "ãˆ¦"},
  ["8"] = {"â‘§", "â“¼", "â½", "â‘»", "â’", "ğŸ„‰", "ï¼˜", "â‚ˆ", "â¸", "ğŸ–", "ğŸ ", "ğŸ¾", "ğŸª", "ğŸ´", "ãŠ‡", "ãˆ§"},
  ["9"] = {"â‘¨", "â“½", "â¾", "â‘¼", "â’", "ğŸ„Š", "ï¼™", "â‚‰", "â¹", "ğŸ—", "ğŸ¡", "ğŸ¿", "ğŸ«", "ğŸµ", "ãŠˆ", "ãˆ¨"},
}

-- æ¨£å¼åç¨±
local style_names_title = {"åœˆåœˆ", "æ‹¬è™Ÿ", "å…¨å½¢", "ç²—é«”", "é›™ç·š", "ç­‰å¯¬", "æ–œé«”", "ç²—æ–œ", "èŠ±é«”", "å“¥å¾·"}  -- èŠ±å¼Aa/aaç”¨ï¼ˆ10ç¨®ï¼‰
local style_names_upper = {"åœˆåœˆ", "è² åœˆ", "æ–¹æ¡†", "è² æ¡†", "æ‹¬è™Ÿ", "å…¨å½¢", "ç²—é«”", "é›™ç·š", "ç­‰å¯¬", "æ–œé«”", "ç²—æ–œ", "èŠ±é«”", "å“¥å¾·"}  -- èŠ±å¼AAç”¨ï¼ˆ13ç¨®ï¼‰
local style_names_digits = {"åœˆåœˆ", "è² åœˆ", "æ–¹æ¡†", "è² æ¡†", "æ‹¬è™Ÿ", "é»æ•¸", "å…¨å½¢", "ä¸‹æ¨™", "ä¸Šæ¨™", "ç²—é«”", "é›™ç·š", "ç­‰å¯¬", "ç„¡è¥¯ç·š", "ç„¡è¥¯ç·šç²—", "åœˆæ¼¢", "æ‹¬æ¼¢"}  -- èŠ±å¼æ•¸å­—ç”¨ï¼ˆ16ç¨®ï¼‰


-- è½‰æ›å­—ç¬¦ï¼ˆèŠ±å¼AAç”¨ï¼Œ13ç¨®æ¨£å¼ï¼‰
local function convert_char_upper(char, idx)
  local up = string.upper(char)
  return fancy_upper[up] and fancy_upper[up][idx] or char
end

-- è½‰æ›å­—ç¬¦ï¼ˆèŠ±å¼Aa/aaç”¨ï¼Œ10ç¨®æ¨£å¼ï¼‰
local function convert_char_title(char, idx, is_upper)
  local up = string.upper(char)
  local lo = string.lower(char)
  if is_upper then
    return fancy_upper_title[up] and fancy_upper_title[up][idx] or char
  else
    return fancy_lower[lo] and fancy_lower[lo][idx] or char
  end
end

local function convert_digit(d, idx)
  return fancy_digits[d] and fancy_digits[d][idx] or d
end

-- è½‰æ›æ–‡å­—ï¼ˆèŠ±å¼AAç”¨ï¼‰
local function convert_text_upper(text, idx)
  local result = {}
  for i = 1, #text do
    local c = text:sub(i, i)
    if c == "." then
      table.insert(result, " ")
    elseif c:match("[a-zA-Z]") then
      table.insert(result, convert_char_upper(c, idx))
    else
      table.insert(result, c)
    end
  end
  return table.concat(result)
end

-- è½‰æ›æ–‡å­—ï¼ˆèŠ±å¼Aa/aaç”¨ï¼‰
local function convert_text_title(text, idx, mode)
  local result = {}
  local word_start = true
  for i = 1, #text do
    local c = text:sub(i, i)
    if c == "." then
      table.insert(result, " ")
      word_start = true
    elseif c:match("[a-zA-Z]") then
      local is_upper = (mode == "title" and word_start) or (mode == "lower" and false) or (mode == "upper" and true)
      if mode == "lower" then
        is_upper = false
      elseif mode == "title" then
        is_upper = word_start
      end
      table.insert(result, convert_char_title(c, idx, is_upper))
      word_start = false
    else
      table.insert(result, c)
    end
  end
  return table.concat(result)
end

local function convert_numbers(text, idx)
  local result = {}
  for i = 1, #text do
    local c = text:sub(i, i)
    if c == "." then
      table.insert(result, " ")
    elseif c:match("[0-9]") then
      table.insert(result, convert_digit(c, idx))
    else
      table.insert(result, c)
    end
  end
  return table.concat(result)
end


local function parse_input(input)
  -- prefix `/ å·²è¢«ç§»é™¤ï¼Œæ‰€ä»¥ input ä¸åŒ…å« `/
  -- `/' â†’ input ä»¥ ' é–‹é ­
  -- `/// â†’ input ä»¥ // é–‹é ­
  -- `// â†’ input ä»¥ / é–‹é ­
  -- `/ â†’ input ç›´æ¥æ˜¯å…§å®¹
  if input:match("^'") then return "number", input:sub(2) end
  if input:match("^//") then return "upper", input:sub(3) end
  if input:match("^/") then return "lower", input:sub(2) end
  -- é è¨­æ˜¯ title æ¨¡å¼ï¼ˆé¦–å­—æ¯å¤§å¯«ï¼‰
  return "title", input
end

local function translator(input, seg, env)
  -- åˆ¤æ–·æ¨¡å¼ï¼ˆæ ¹æ“š tagï¼‰
  local mode, preedit_prefix, preedit_name
  if seg:has_tag("fancy_title") then
    mode = "title"
    preedit_prefix = "`/"
    preedit_name = "ã€ŠèŠ±å¼Aaã€‹"
  elseif seg:has_tag("fancy_lower") then
    mode = "lower"
    preedit_prefix = "`//"
    preedit_name = "ã€ŠèŠ±å¼aaã€‹"
  elseif seg:has_tag("fancy_upper") then
    mode = "upper"
    preedit_prefix = "`///"
    preedit_name = "ã€ŠèŠ±å¼AAã€‹"
  elseif seg:has_tag("fancy_number") then
    mode = "number"
    preedit_prefix = "`/'"
    preedit_name = "ã€ŠèŠ±å¼æ•¸å­—ã€‹"
  else
    return
  end
  
  -- input æ˜¯ç§»é™¤ prefix å¾Œçš„å…§å®¹
  local content = input
  
  -- åªæœ‰å‰ç¶´æ™‚ä¸ç”Ÿæˆå€™é¸å­—ï¼ˆç”± tips è™•ç†ï¼‰
  if content == "" then
    return
  end
  
  -- ç”Ÿæˆå„ç¨®å­—é«”æ¨£å¼çš„å€™é¸
  local preedit = preedit_prefix .. preedit_name .. content:gsub("%.", " ")
  
  if mode == "number" then
    -- æ•¸å­—æ¨¡å¼ï¼š16 ç¨®æ¨£å¼
    -- ç§»é™¤çµå°¾çš„ 'ï¼ˆç”¨æ–¼æ•¸å­—é¸å­—çš„æ¨™è¨˜ï¼‰
    local num_content = content:gsub("'$", "")
    for idx = 1, #style_names_digits do
      local converted = convert_numbers(num_content, idx)
      local cand = Candidate("fancy", seg.start, seg._end, converted, "")
      cand.preedit = preedit
      yield(cand)
    end
  elseif mode == "upper" then
    -- èŠ±å¼AAï¼š13 ç¨®æ¨£å¼
    for idx = 1, #style_names_upper do
      local converted = convert_text_upper(content, idx)
      local cand = Candidate("fancy", seg.start, seg._end, converted, "")
      cand.preedit = preedit
      yield(cand)
    end
  else
    -- èŠ±å¼Aaã€èŠ±å¼aaï¼š10 ç¨®æ¨£å¼
    for idx = 1, #style_names_title do
      local converted = convert_text_title(content, idx, mode)
      local cand = Candidate("fancy", seg.start, seg._end, converted, "")
      cand.preedit = preedit
      yield(cand)
    end
  end
end

return translator
